# description	: GNOME compositing window manager based on Clutter
# depends	: glib gobject-introspection graphene gdk-pixbuf pango
# depends	: cairo pixman fribidi gsettings-desktop-schemas libice
# depends	: gnome-settings-daemon json-glib libxkbcommon dbus libei
# depends	: at-spi2-core colord lcms2 harfbuzz libcanberra libglvnd
# depends	: wayland wayland-protocols libdrm mesa libinput elogind
# depends	: xwayland libgudev libsm libwacom startup-notification
# depends	: pipewire libdisplay-info gtk4 libx11 libxcomposite
# depends	: libxcursor libxdamage libxext libxfixes libxtst libxcb
# depends	: libxkbfile xkeyboard-config libxrender libxrandr libxau
# depends	: libxinerama xorg-proto gettext linux-api-headers libxcvt

name=mutter
version=48.4
release=1
source="https://download.gnome.org/sources/mutter/${version%.*}/$name-$version.tar.xz"

build() {
    cd $name-$version

    # Fix an issue with the tests that would otherwise require the package to be 
    # built with debugging information
    sed "/tests_c_args =/s/$/ + ['-U', 'G_DISABLE_ASSERT']/" -i src/tests/meson.build &&
    sed "/c_args:/a '-U', 'G_DISABLE_ASSERT'," -i src/tests/cogl/unit/meson.build

	meson setup \
        --prefix=/usr \
        --buildtype=plain \
        -D tests=disabled \
        -D profiler=false \
        build
	ninja -C build
}

package() {
    cd $name-$version

    DESTDIR="$PKG" ninja -C build install
}