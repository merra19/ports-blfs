# description	: Provides file and print services to SMB/CIFS clients and Windows networking to Linux clients
# depends	: gnutls libtirpc perl-parse-yapp rpcsvc-proto fuse gpgme
# depends	: icu jansson libtasn1 libxslt pam lmdb krb5 openldap cups
# depends	: avahi gnupg libaio libarchive libcap libgcrypt libnsl
# depends	: libunwind py3-markdown nss popt

name=samba
version=4.21.4
release=1
source="https://download.samba.org/pub/samba/stable/$name-$version.tar.gz"

build() {
	cd $name-$version

    /configure \
        --prefix=/usr \
        --sysconfdir=/etc \
        --localstatedir=/var \
        --with-piddir=/run/samba \
        --with-pammodulesdir=/usr/lib/security \
        --enable-fhs \
        --without-ad-dc \
        --with-system-mitkrb5 \
        --enable-selftest \
        --disable-rpath-install
    make
}

package() {
    cd $name-$version

    make  DESTDIR="$PKG" install

    install -v -m644    examples/smb.conf.default "$PKG"/etc/samba

    sed -e "s;log file =.*;log file = /var/log/samba/%m.log;" \
        -e "s;path = /usr/spool/samba;path = /var/spool/samba;" \
        -i "$PKG"/etc/samba/smb.conf.default &&

    mkdir -pv "$PKG"/etc/openldap/schema

    install -v -m644    examples/LDAP/README \
                        "$PKG"/etc/openldap/schema/README.samba

    install -v -m644    examples/LDAP/samba* \
                        "$PKG"/etc/openldap/schema

    install -v -m755    examples/LDAP/{get*,ol*} \
                        "$PKG"/etc/openldap/schema
}